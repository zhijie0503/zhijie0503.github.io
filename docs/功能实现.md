# 方格消除游戏 - 功能实现

## 主要功能

本游戏实现了以下功能：

1. **20x20网格** - 创建一个包含400个方格的游戏区域
2. **随机数字生成** - 每个方格包含1-9的随机数
3. **鼠标拖动选择** - 实现了直观的拖动交互以选择相邻方格
4. **数字求和消除** - 当选中区域的数字之和等于10时，这些方格会被消除
5. **消除后透明显示** - 消除后的方格会清零并半透明显示
6. **时间限制** - 每局游戏限时60秒
7. **计分系统** - 每消除一个方格得1分
8. **等级评价** - 根据最终得分评定玩家等级
9. **重新开始按钮** - 可以随时重置游戏

## 实现细节

### 网格生成

```typescript
// 定义网格大小
const GRID_SIZE = 20
const TARGET_SUM = 10
const GAME_DURATION = 60 // 游戏时长（秒）

// 生成1-9的随机数
const generateRandomNumber = () => Math.floor(Math.random() * 9) + 1

// 生成初始网格
const generateGrid = () => {
  const grid = []
  for (let i = 0; i < GRID_SIZE; i++) {
    const row = []
    for (let j = 0; j < GRID_SIZE; j++) {
      row.push({
        value: generateRandomNumber(),
        id: `${i}-${j}`,
        isZero: false
      })
    }
    grid.push(row)
  }
  return grid
}
```

### 拖动选择实现

游戏通过以下鼠标事件实现拖动选择功能：

1. `onMouseDown` - 开始选择
2. `onMouseEnter` - 扩展选择区域
3. `onMouseUp` - 完成选择
4. `onMouseLeave` - 处理鼠标离开网格的情况

要点：
- 只允许选择相邻的方格
- 不能选择值为0的方格
- 实时计算选中方格的数字总和
- 当总和等于10时自动消除

### 数字消除与透明显示

```typescript
// 当和为10时清除选中单元格
if (sum === TARGET_SUM && selectedCells.length > 0) {
  // 创建新的网格数据
  const newGrid = [...grid]
  
  // 将选中的单元格值设为0并标记为透明
  selectedCells.forEach(({ row, col }) => {
    newGrid[row][col] = {
      ...newGrid[row][col],
      value: 0,
      isZero: true
    }
  })
  
  // 更新得分（每个方格1分）
  onScoreChange(selectedCells.length)
  
  // 更新状态
  setGrid(newGrid)
  setSelectedCells([])
  setSelectionSum(0)
}
```

### 时间限制实现

游戏添加了60秒的时间限制，通过React的`useEffect`钩子和`setInterval`实现计时器功能：

```typescript
// 游戏计时器
useEffect(() => {
  if (!gameActive) return

  const timer = setInterval(() => {
    setTimeLeft(prev => {
      if (prev <= 1) {
        clearInterval(timer)
        setGameActive(false)
        onGameEnd(0) // 会在App组件中获取实际分数
        return 0
      }
      return prev - 1
    })
  }, 1000)

  return () => clearInterval(timer)
}, [gameActive, onGameEnd])
```

### 等级评价系统

游戏结束后会根据玩家得分评定等级：

```typescript
// 等级评价系统
const getLevelTitle = (score: number) => {
  if (score < 60) return '继续努力'
  if (score < 70) return 'L5'
  if (score < 80) return 'L6'
  if (score < 90) return 'L7'
  if (score < 100) return 'L8'
  if (score < 110) return 'L9'
  if (score < 120) return 'L10'
  if (score < 130) return 'L11'
  if (score < 140) return 'L12'
  if (score < 150) return 'L13'
  return '兴哥'
}
```

### 视觉反馈

游戏实现了丰富的视觉反馈机制：

1. 根据数字值设置不同的颜色
2. 选中的方格有特殊的高亮效果
3. 当前选择的总和实时显示
4. 消除后的方格半透明显示
5. 倒计时显示
6. 游戏结束后显示分数和等级 