# 方格消除游戏 - 部署指南

本文档介绍如何将方格消除游戏部署到各种服务器环境中。

## 构建生产版本

首先，需要构建游戏的生产版本：

```bash
# 安装依赖
npm install

# 构建生产版本
npm run build
```

构建完成后，所有静态文件将生成在 `dist` 目录中。

## 部署选项

### 1. 静态网站托管服务

由于游戏是纯前端应用，最简单的部署方式是使用静态网站托管服务：

#### Netlify 部署

1. 在 [Netlify](https://www.netlify.com/) 注册账号
2. 选择"从Git导入项目"或直接上传 `dist` 文件夹
3. 如果使用Git导入，可以设置构建命令为 `npm run build`，发布目录为 `dist`

#### Vercel 部署

1. 在 [Vercel](https://vercel.com/) 注册账号
2. 导入您的项目仓库或上传 `dist` 文件夹
3. Vercel 会自动识别Vite项目并设置正确的构建选项

#### GitHub Pages 部署

1. 创建 `deploy.sh` 脚本文件：

```bash
#!/usr/bin/env sh

# 发生错误时终止
set -e

# 构建
npm run build

# 进入构建文件夹
cd dist

# 如果你要部署到自定义域名
# echo 'www.example.com' > CNAME

git init
git add -A
git commit -m 'deploy'

# 如果你要部署在 https://<USERNAME>.github.io
# git push -f git@github.com:<USERNAME>/<USERNAME>.github.io.git main

# 如果你要部署在 https://<USERNAME>.github.io/<REPO>
git push -f git@github.com:<USERNAME>/<REPO>.git main:gh-pages

cd -
```

2. 修改 `vite.config.ts` 添加正确的基础路径：

```typescript
export default defineConfig({
  plugins: [react()],
  base: '/games-demo/', // 使用你的仓库名称
})
```

### 2. 使用传统Web服务器

如果要使用传统Web服务器（如Nginx、Apache等）：

#### Nginx 配置

1. 将构建好的 `dist` 目录内容上传到服务器
2. 配置Nginx：

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    root /path/to/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

#### Apache 配置

在 `dist` 目录中创建 `.htaccess` 文件：

```apache
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  RewriteRule ^index\.html$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>
```

### 3. Docker 部署

您也可以使用Docker容器部署：

1. 创建 `Dockerfile`：

```dockerfile
FROM node:16 as build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

2. 构建并运行Docker镜像：

```bash
docker build -t games-demo .
docker run -p 80:80 games-demo
```

## 环境配置

如果游戏需要任何环境变量，可以在 `.env` 文件中定义。在Vite项目中，可以使用以下命名约定：

- `.env` - 所有环境都加载
- `.env.local` - 所有环境都加载，但会被git忽略
- `.env.production` - 仅生产环境加载

## 性能优化建议

1. 启用Gzip压缩以减少文件大小
2. 设置适当的缓存头以提高加载速度
3. 使用CDN分发静态资源

## 故障排除

如果遇到路由问题，确保服务器配置正确处理了前端路由。对于单页应用，所有路由请求应重定向到index.html。 